import{_ as e,C as r,c as p,o as h,a4 as t,G as n,j as i,a}from"./chunks/framework.C_GGjjHE.js";const E=JSON.parse('{"title":"七.2.NAT网络地址转换","description":"","frontmatter":{},"headers":[],"relativePath":"views/study/ne/theory/七/2.NAT网络地址转换.md","filePath":"views/study/ne/theory/七/2.NAT网络地址转换.md","lastUpdated":1758878470000}'),d={name:"views/study/ne/theory/七/2.NAT网络地址转换.md"};function k(o,s,u,g,A,T){const l=r("ImageViewer");return h(),p("div",null,[s[0]||(s[0]=t('<h1 id="七-2-nat网络地址转换" tabindex="-1">七.2.NAT网络地址转换 <a class="header-anchor" href="#七-2-nat网络地址转换" aria-label="Permalink to &quot;七.2.NAT网络地址转换&quot;">​</a></h1><h3 id="_1-简介" tabindex="-1">1.简介 <a class="header-anchor" href="#_1-简介" aria-label="Permalink to &quot;1.简介&quot;">​</a></h3><p>网络地址转换NAT(Network Address Translation)是将IP数据报文头中的IP地址转换为另一个IP地址的过程(包括传输层端口号)<br><br> NAT优点</p><ul><li>一定程度上缓解IP地址空间枯竭的压力(IPv4)</li><li>有效避免来自外网的攻击，可以很大程度上提高网络安全性</li><li>可以实现服务负载均衡</li></ul><p>缺点</p><ul><li>网络监控难度加大</li><li>限制某些具体应用</li></ul><h3 id="_2-分类" tabindex="-1">2.分类 <a class="header-anchor" href="#_2-分类" aria-label="Permalink to &quot;2.分类&quot;">​</a></h3><p>根据应用场景的不同，NAT可以分为以下3类</p><ul><li>1.源NAT(Source NAT)：对报文中的源地址进行转换。适用于用户通过<span class="green">私网地址访问Internet</span>的场景</li><li>2.目的NAT(Destination NAT)：对报文中的目的地址进行转换。适用于用户通过<span class="green">公网地址访问私网服务器</span>的场景</li><li>3.双向NAT(Bidirectional NAT)：在转换过程中同时转换报文的源信息和目的信息。适用于通信双方访问对方的时候<span class="green">目的地址都不是真实的地址</span>，而是NAT转换后的地址的场景</li></ul><p>根据具体实现方式的不同，又可以分为以下几类</p><ul><li>1.静态NAT</li><li>2.动态NAT</li><li>3.NAPT</li><li>4.Easy ip</li><li>5.NAT Server</li></ul><h3 id="_3-nat技术原理" tabindex="-1">3.NAT技术原理 <a class="header-anchor" href="#_3-nat技术原理" aria-label="Permalink to &quot;3.NAT技术原理&quot;">​</a></h3><ul><li>NAT：对IP数据报文中的IP地址进行转换，是一种在现网中被广泛部署的技术，一般部署在网络出口设备，例如路由器或防火墙上。</li><li>NAT的典型应用场景：在私有网络内部(园区、家庭)使用私有地址，出口设备部署NAT，对于&quot;从内到外&quot;的流量，网络设备通过NAT将数据包的源地址进行转换(转换成特定的公有地址)，而对于&quot;从外到内的&quot;流量，则对数据包的目的地址进行转换</li><li>通过私有地址的使用结合NAT技术，可以有效节约公网IPv4地址</li></ul>',13)),n(l,{src:"/blog/images/study/ne/NAT技术原理.png",title:"NAT技术原理"}),s[1]||(s[1]=i("br",null,null,-1)),s[2]||(s[2]=i("h4",{id:"_1-静态nat原理",tabindex:"-1"},[a("1.静态NAT原理 "),i("a",{class:"header-anchor",href:"#_1-静态nat原理","aria-label":'Permalink to "1.静态NAT原理"'},"​")],-1)),s[3]||(s[3]=i("ul",null,[i("li",null,"静态NAT：每个私有地址都有一个与之对应并且固定的公有地址，即私有地址和公有地址直接的关系是一对一映射"),i("li",null,"支持双向互访：私有地址访问Internet经过出口设备NAT转换时，会被转换成对应的公有地址。同时，外部网络访问内部网络时，其报文中携带的公有地址(目的地址)也会被NAT设备转换成对应的私有地址")],-1)),n(l,{src:"/blog/images/study/ne/静态NAT原理.png",title:"静态NAT原理"}),s[4]||(s[4]=t(`<br><h5 id="配置" tabindex="-1">配置 <a class="header-anchor" href="#配置" aria-label="Permalink to &quot;配置&quot;">​</a></h5><p>1.接口视图下配置静态NAT</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Huawei</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GigabitEthernet0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] nat static global {global</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address} inside {host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// global参数用于配置外部公有地址，inside参数用于配置内部私有地址</span></span></code></pre></div><p>2.系统视图下配置静态NAT</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Huawei] nat static global {global</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address} inside {host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 配置命令相同，视图为系统视图，之后在具体的接口下开启静态NAT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Huawei</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GigabitEthernet0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] nat static enable</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 在接口西使用nat static功能</span></span></code></pre></div><h5 id="示例" tabindex="-1">示例 <a class="header-anchor" href="#示例" aria-label="Permalink to &quot;示例&quot;">​</a></h5>`,7)),n(l,{src:"/blog/images/study/ne/静态NAT配置实例.png",title:"静态NAT配置实例"}),s[5]||(s[5]=i("br",null,null,-1)),s[6]||(s[6]=i("h4",{id:"_2-动态nat原理",tabindex:"-1"},[a("2.动态NAT原理 "),i("a",{class:"header-anchor",href:"#_2-动态nat原理","aria-label":'Permalink to "2.动态NAT原理"'},"​")],-1)),s[7]||(s[7]=i("ul",null,[i("li",null,[a("动态NAT：静态NAT严格地一对一进行地址映射，这就导致即便内网主机长时间离线或者不发送数据时，与之对应的公有地址也处于使用状态。为了避免地址浪费，动态NAT提出了地址池的概念：所有可用的"),i("span",{class:"brown"},"公有地址组成地址池")]),i("li",null,'当内部主机访问外部网络时临时分配一个地址池中未使用的地址，并将该地址标记为"In Use"。当该主机不再访问外部网络时回收分配的地址，重新标记为"Not Use"')],-1)),n(l,{src:"/blog/images/study/ne/动态NAT原理.png",title:"动态NAT原理"}),s[8]||(s[8]=t(`<br><h5 id="配置-1" tabindex="-1">配置 <a class="header-anchor" href="#配置-1" aria-label="Permalink to &quot;配置&quot;">​</a></h5><p>1.创建地址池</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Huawei] nat address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">group group</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address end</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 配置公有地址范围，其中group-index为地址池编号，start-address、end-address分别为地址池起始地址。结束地址</span></span></code></pre></div><p>2.配置地址转换的ACL规则</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Huawei] acl number</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Huawei</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">acl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">basic</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">number] rule permit source source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">address source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wildcard</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 配置基础ACL，匹配需要进行动态转换的源地址范围</span></span></code></pre></div><p>3.接口视图下配置带地址池的NAT Outbound</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Huawei</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GigabitEthernet0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] nat outbound acl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">number address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">group group</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index[no</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pat]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 接口下关联ACL与地址池进行动态地址转换，no-pat参数指定不进行端口转换</span></span></code></pre></div><h5 id="示例-1" tabindex="-1">示例 <a class="header-anchor" href="#示例-1" aria-label="Permalink to &quot;示例&quot;">​</a></h5>`,9)),n(l,{src:"/blog/images/study/ne/动态NAT配置实例.png",title:"动态NAT配置实例"}),s[9]||(s[9]=i("br",null,null,-1)),s[10]||(s[10]=i("h4",{id:"_3-napt技术原理",tabindex:"-1"},[a("3.NAPT技术原理 "),i("a",{class:"header-anchor",href:"#_3-napt技术原理","aria-label":'Permalink to "3.NAPT技术原理"'},"​")],-1)),s[11]||(s[11]=i("ul",null,[i("li",null,"动态NAT选择地址池中的地址进行地址转换时不会转换端口号，即No-PAT(No-Port Address Translation，非端口地址转换)，公有地址与私有地址还是1:1的映射关系，无法提高公有地址利用率"),i("li",null,"NAPT(Network Address and Port Translation，网络地址端口转换)：从地址池中选择地址进行地址转换时不仅转换IP地址，同事也会对端口号进行转换，从而实现公有地址与私有地址的1：n映射，可以有效提高公有地址利用率")],-1)),n(l,{src:"/blog/images/study/ne/NAPT技术原理.png",title:"NAPT技术原理"}),s[12]||(s[12]=i("br",null,null,-1)),s[13]||(s[13]=i("h5",{id:"示例-2",tabindex:"-1"},[a("示例 "),i("a",{class:"header-anchor",href:"#示例-2","aria-label":'Permalink to "示例"'},"​")],-1)),n(l,{src:"/blog/images/study/ne/NAPT配置示例.png",title:"NAPT配置示例"}),s[14]||(s[14]=i("br",null,null,-1)),s[15]||(s[15]=i("h4",{id:"_4-easy-ip",tabindex:"-1"},[a("4.Easy IP "),i("a",{class:"header-anchor",href:"#_4-easy-ip","aria-label":'Permalink to "4.Easy IP"'},"​")],-1)),s[16]||(s[16]=i("ul",null,[i("li",null,[a("Easy IP：实现原理和NAPT相同，同时转换IP地址、传输层端口，区别在于Easy IP没有地址池的概念，使用"),i("span",{class:"brown"},"接口地址"),a("作为NAT转换的公有地址")]),i("li",null,"Easy IP适用于不具备固定公网IP地址的场景：如通过DHCP、PPPoE拨号获取地址的私有网络出口，可以直接使用获取到的动态地址进行转换")],-1)),n(l,{src:"/blog/images/study/ne/EasyIP技术原理.png",title:"EasyIP技术原理"}),s[17]||(s[17]=i("br",null,null,-1)),s[18]||(s[18]=i("h5",{id:"示例-3",tabindex:"-1"},[a("示例 "),i("a",{class:"header-anchor",href:"#示例-3","aria-label":'Permalink to "示例"'},"​")],-1)),n(l,{src:"/blog/images/study/ne/EasyIP配置示例.png",title:"EasyIP配置示例"}),s[19]||(s[19]=i("br",null,null,-1)),s[20]||(s[20]=i("h4",{id:"_5-nat-server",tabindex:"-1"},[a("5.NAT Server "),i("a",{class:"header-anchor",href:"#_5-nat-server","aria-label":'Permalink to "5.NAT Server"'},"​")],-1)),s[21]||(s[21]=i("ul",null,[i("li",null,"NAT Server：指定[公有地址：端口]与[私有地址：端口]的一对一映射关系，将内网服务器映射到公网，当私有网络中的服务器需要对公网提供服务时使用"),i("li",null,"外网主机主动访问[公有地址：端口]实现对内网服务器的访问")],-1)),n(l,{src:"/blog/images/study/ne/NATServer.png",title:"NATServer"}),s[22]||(s[22]=i("br",null,null,-1)),s[23]||(s[23]=i("ul",null,[i("li",null,"外网主动访问内网时，NAT Server和NAT Static无差别"),i("li",null,"内网主动访问外网时，NAT Server仅做地址替换。NAT Static会同时替换地址和端口号")],-1)),s[24]||(s[24]=i("h5",{id:"示例-4",tabindex:"-1"},[a("示例 "),i("a",{class:"header-anchor",href:"#示例-4","aria-label":'Permalink to "示例"'},"​")],-1)),n(l,{src:"/blog/images/study/ne/NATServer配置示例.png",title:"NATServer配置示例.png"}),s[25]||(s[25]=i("br",null,null,-1)),s[26]||(s[26]=i("h4",{id:"_6-双向nat",tabindex:"-1"},[a("6.双向NAT "),i("a",{class:"header-anchor",href:"#_6-双向nat","aria-label":'Permalink to "6.双向NAT"'},"​")],-1)),s[27]||(s[27]=i("ul",null,[i("li",null,"双向NAT是指在转换过程中同时转换报文的源/目的IP地址。双向NAT不是一个单独的功能，而是源/NAT和目的NAT的组合"),i("li",null,[i("span",{class:"brown"},"双向NAT是针对同一条流，在其经过防火墙时同时转换报文的源地址和目的地址")])],-1)),n(l,{src:"/blog/images/study/ne/双向NAT.png",title:"双向NAT"}),s[28]||(s[28]=i("br",null,null,-1)),s[29]||(s[29]=i("h5",{id:"域间双向nat",tabindex:"-1"},[a("域间双向NAT "),i("a",{class:"header-anchor",href:"#域间双向nat","aria-label":'Permalink to "域间双向NAT"'},"​")],-1)),s[30]||(s[30]=i("p",null,[i("span",{class:"brown"},"当内网服务器未配置网关或去往外网的路由时"),a("：此时外网用户访问内网服务器时需要双向转换")],-1)),n(l,{src:"/blog/images/study/ne/域间NAT.png",title:"域间双向NAT"}),s[31]||(s[31]=i("br",null,null,-1)),s[32]||(s[32]=i("h5",{id:"域内双向nat",tabindex:"-1"},[a("域内双向NAT "),i("a",{class:"header-anchor",href:"#域内双向nat","aria-label":'Permalink to "域内双向NAT"'},"​")],-1)),s[33]||(s[33]=i("p",null,[i("span",{class:"brown"},"内网用户通过域名或公网IP访问内网服务器"),a("：此时内网用户访问内网服务器的数据流需要双向转换，源地址转换+NAT Server")],-1)),n(l,{src:"/blog/images/study/ne/域内双向NAT.png",title:"域内双向NAT"}),s[34]||(s[34]=i("br",null,null,-1)),s[35]||(s[35]=i("h3",{id:"_4-nat处理流程",tabindex:"-1"},[a("4.NAT处理流程 "),i("a",{class:"header-anchor",href:"#_4-nat处理流程","aria-label":'Permalink to "4.NAT处理流程"'},"​")],-1)),s[36]||(s[36]=i("p",null,"防火墙上针对不同的NAT类型会采用不同的NAT策略，具体处理流程如下：",-1)),n(l,{src:"/blog/images/study/ne/NAT处理流程.png",title:"NAT处理流程"}),s[37]||(s[37]=t('<br><h3 id="_5-黑洞路由" tabindex="-1">5.黑洞路由 <a class="header-anchor" href="#_5-黑洞路由" aria-label="Permalink to &quot;5.黑洞路由&quot;">​</a></h3><ul><li>1.简介</li><li><ul><li>黑洞路由是一条静态路由</li></ul></li><li><ul><li>出口接口为Null0 (例如：ip route-static 3.1.1.10 255.255.255.255 null0)</li></ul></li><li><ul><li>黑洞路由主要用来进行数据的过滤和环路避免等</li></ul></li><li><ul><li>在使用NAT(如<span class="green">源NAT、NAT Server</span>)时，经常需要配置黑洞路由，防止环路的产生</li></ul></li><li>2.当NAT地址池地址与公网接口地址<span class="green">不在同一网段时</span>，<span class="brown">必须</span>配置黑洞路由</li><li>3.当配置指定协议和端口的NAT Server的global地址与公网接口地址<span class="green">不在同一网段时</span>，<span class="brown">必须</span>配置黑洞路由</li><li>4.当NAT地址池地址或NAT Server的global地址与公网接口地址<span class="green">在同一网段时</span>，<span class="brown">建议</span>配置黑洞路由</li><li>5.当NAT地址池地址或NAT Server的global地址与公网<span class="green">接口地址一致时</span>，不会产生路由环路，<span class="brown">不需要</span>配置黑洞路由</li></ul><h3 id="_6-nat场景下的问题" tabindex="-1">6.NAT场景下的问题 <a class="header-anchor" href="#_6-nat场景下的问题" aria-label="Permalink to &quot;6.NAT场景下的问题&quot;">​</a></h3><h4 id="环路问题1" tabindex="-1">环路问题1 <a class="header-anchor" href="#环路问题1" aria-label="Permalink to &quot;环路问题1&quot;">​</a></h4><p>问题5.2</p>',6)),n(l,{src:"/blog/images/study/ne/NAT环路问题1.png",title:"NAT环路问题1"}),s[38]||(s[38]=i("br",null,null,-1)),s[39]||(s[39]=i("h4",{id:"环路问题2",tabindex:"-1"},[a("环路问题2 "),i("a",{class:"header-anchor",href:"#环路问题2","aria-label":'Permalink to "环路问题2"'},"​")],-1)),s[40]||(s[40]=i("p",null,"问题5.4",-1)),n(l,{src:"/blog/images/study/ne/NAT环路问题2.png",title:"NAT环路问题2"}),s[41]||(s[41]=i("br",null,null,-1)),s[42]||(s[42]=i("h3",{id:"_7-防火墙解决方案",tabindex:"-1"},[a("7.防火墙解决方案 "),i("a",{class:"header-anchor",href:"#_7-防火墙解决方案","aria-label":'Permalink to "7.防火墙解决方案"'},"​")],-1)),n(l,{src:"/blog/images/study/ne/防火墙解决方案.png",title:"防火墙解决方案"}),s[43]||(s[43]=i("br",null,null,-1))])}const N=e(d,[["render",k]]);export{E as __pageData,N as default};
